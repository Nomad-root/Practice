name: release

on:
  workflow_dispatch:
    inputs:
      image_tag:
        type: string
        required: true

jobs:

  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Docker login
      env:
        DOCKER_LOGIN: oauth
        DOCKER_PASSWORD: ${{ secrets.YA_REGISTRY_TOKEN }}
      run: docker login cr.yandex --username $DOCKER_LOGIN --password $DOCKER_PASSWORD

    - name: Build
      run: docker build --tag python-docker:${{ github.event.inputs.message }} python-docker:latest

    - name: Push
      run: docker push python-docker
